/*
 Modifications performed to this file by anyone other than Solid State Networks
 are unsupported and may void your software warranty.
*/
$(document).ready(function(){host.assert("3.6.8.1"===app.expandString("{AppVersion}"),"Invalid application version")});
(function(){function a(){this.machineId=app.expandString("{SHA1:{Lower:{PrimaryMAC}{DiskSerial:{SystemPath}}}}");this.sessionId=app.expandString("{Guid}");this.hostname=this.token="";this.debug=!1;this.nameTag=null;this.shutdown=!1;this.xhr=this.dummyObj=null;this.queue=[]}a.prototype.setToken=function(a){this.token=a};a.prototype.setHostname=function(a){this.hostname=a};a.prototype.setDebug=function(a){this.debug=a};a.prototype.setNameTag=function(a){this.nameTag=a};a.prototype.onStartup=function(){!0===
interop.isInteropLoaded("downloader")?this.dummyObj=createHttpRequest():this.shutdown=!0};a.prototype.onCheckShutdown=function(){!1!==this.shutdown&&(0===this.queue.length&&!isNull(this.dummyObj))&&(this.dummyObj.release(),this.dummyObj=null)};a.prototype.onLoadGeoIP=function(){var a=this;this.xhr=$.getJSON("http://geoip.snxd.com/geoip/json/",function(b){a.xhr=null;window.geoIP={};mergeObjectProperties(window.geoIP,b,!1);a.onSendRequest()}).error(function(){a.xhr=null;window.geoIP={};app.debugPrint("Failed to return geo ip information\n");
a.onSendRequest()})};a.prototype.onSendRequest=function(){if(0===this.queue.length||null!==this.xhr)this.onCheckShutdown();else if(isNull(window.geoIP))this.onLoadGeoIP();else{var a=this.queue.shift(),b=this;this.xhr=$.get(a,function(){b.xhr=null;b.onSendRequest()}).error(function(){b.queue=[];b.shutdown=!0;app.debugPrint("Unable to send mix panel analytics\n");b.xhr=null;b.onSendRequest()})}};a.prototype.trackUserInfo=function(a){if(!(0>=this.token.length))if(!0===this.shutdown)app.debugPrint("Skipping analytics event because of shutdown\n");
else{var b={},c={};mergeObjectProperties(c,a,!1);b.$distinct_id=this.machineId;b.$token=app.expandString(this.token);b.$set={};hasOwnProperty(c,"email")&&(b.$set.$email=c.email,delete c.email);hasOwnProperty(c,"firstName")&&(b.$set.$first_name=c.firstName,delete c.firstName);hasOwnProperty(c,"lastName")&&(b.$set.$last_name=c.lastName,delete c.lastName);hasOwnProperty(c,"created")&&(b.$set.$created=c.created,delete c.created);hasOwnProperty(c,"lastLogin")&&(b.$set.$last_login=c.lastLogin,delete c.lastLogin);
mergeObjectProperties(b.$set,c);isNull(window.geoIP)||mergeObjectProperties(b.$set,window.geoIP,!0);this.queue.push("http://{0}/engage/?data={1}".format(window.analytics.hostname,app.base64Encode(JSON.stringify(b))));this.onSendRequest()}};a.prototype.trackEvent=function(a){if(!(0>=this.token.length))if(host.assert(!isNull(a.event),"Analytics ReportEvent missing event"),!0===this.shutdown)app.debugPrint("Skipping analytics ({0}) event because of shutdown\n".format(a.event));else{var b={},c="1";b.event=
a.event;b.distinct_id=this.machineId;b.properties={};b.properties.token=app.expandString(this.token);b.properties.time=(new Date).getTime();isNull(this.nameTag)||(b.properties.mp_name_tag=this.nameTag);getObjectProperties(a).forEach(function(c){c.toLowerCase()!=="event"&&(b.properties[c]=a[c])});isNull(window.geoIP)||mergeObjectProperties(b.properties,window.geoIP,!0);hasOwnProperty(b.properties,"ip")&&(c="0");!0===this.debug&&app.debugPrint("Sending analytics event ({0})\n".format(b.event));this.queue.push("http://{0}/track/?data={1}&ip={2}".format(window.analytics.hostname,
app.base64Encode(JSON.stringify(b)),c));this.onSendRequest()}};a.prototype.onReportEvent=function(a,b){this.trackEvent(b)};window.analytics=new a;notificationCenter.addObserver("Workflow","DidLoad",function(){window.analytics.onStartup()});notificationCenter.addObserver("Workflow","WillUnload",function(){setTimeout(function(){window.analytics.shutdown=!0;window.analytics.onCheckShutdown()},0)});notificationCenter.addObserver("NotificationCheckpoint","ReportEvent",function(a,b){window.analytics.onReportEvent(a,
b)})})();function AnalyticsController(a){var d=this;this.observers=[];this.observers.push(notificationCenter.addInstanceObserver("Task","Start",a,function(b,c){d.onStart(a,c)}))}AnalyticsController.prototype.release=function(){this.observers.forEach(function(a){a.release()});this.observers=[]};
AnalyticsController.prototype.onStart=function(a){a.assertArgument("hostname");a.assertArgument("token");a.assertArgument("checkpointPath");window.analytics.setToken(app.expandString(a.args.token));window.analytics.setHostname(app.expandString(a.args.hostname));hasOwnProperty(a.args,"debug")&&!0===a.args.debug&&window.analytics.setDebug(!0);loadNotificationCheckpoints(a.args.checkpointPath,function(){a.complete()})};registerTaskController("loadAnalytics",AnalyticsController);
